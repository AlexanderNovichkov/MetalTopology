# Metal Topology
Данная программа позволяет вычислять персистентные гомологии на GPU. Для взаимодействия с GPU используется фреймворк Metal API. Можно подключить ее в виде фреймворка в проект или использовать консольное приложение.

## Консольное приложение
Приложение расположено по пути `cmd/compute`.
Оно строит матрицу инцидентности симплициального комплекса по входному файлу, находит устойчивые пары и записывает их в выходной файл.

### Аргументы
1. `--gpuId <number>`  - задает индекс видеокарты,  на которой будут производиться вычисления. Значение по умолчанию: 0.
2. `--inputType <string>` - задает формат входного файла. Возможные значения: `matrix`, `simplicies`. Значение по умолчанию: `matrix`.
3. Путь ко входному файлу.
4. Путь к выходному файлу.

Пример команды: ```./compute --gpuId 1 input.txt output.txt```

### Формат входного файла типа `matrix` с матрицей инцидентности симплициального комплекса
Первая строка содержит 2 числа через пробел, которые задают число симплексов в комплексе (колонок в матрице) N и число ненулевых элементов в матрице.
Следующие N строк задают симплексы (порядок симплексов важен, их размерности и значения функции фильтрации на них должны идти в неубывающем порядке). Первое число в строке задает число симплексов M, инцидентных данному (число ненулевых элементов в колонке). Следующие M чисел задают индексы симплексов, инцидентных данному (индексы ненулевых строк в данной колонке). 

Пример файла можно найти по пути: `MetalTopologyTests/static/matrix_h3n2_2_30.0.txt`.


### Формат входного файла типа `simplicies` с симплексами комплекса
Первая строка содержит число симплексов N.
Следующие N строк задают симплексы (порядок симплексов важен, их размерности и значения функции фильтрации на них должны идти в неубывающем порядке). Первое число в строке задает число вершин симплекса. Следующие M чисел задают вершины симплекса в порядке возрастания.

Пример файла можно найти по пути: `MetalTopologyTests/static/simplicies_0.txt`.

### Формат выходного файла с устойчивыми парами
Первое число задает количество устойчивых пар. Последующие строки содержат по 2 числа через пробел, которые задают индексы положительного и отрицательного симплексов. Все пары отсортированы по индексу положительного симплекса.

Пример файла можно найти по пути: `MetalTopologyTests/static/matrix_h3n2_2_30.0_pairs.txt`.

## Классы библиотеки
- SparseMatrix - класс для хранения разреженной матрицы в памяти, к которой GPU имеет доступ. Содержит методы для чтения из файла и записи в файл.
- SparseMatrixBuilder - класс для построения матрицы.
- PhComputation  - класс для вычисления персистентных гомологий. Метод Compute редуцирует матрицу и возвращает результат. Метод getPersistentPairs позволяет получить устойчивые пары, его можно вызывать только после вызова метода Compute.
- PersistencePairs - класс для работы с  устойчивыми парами. Содержит методы для чтения из файла и записи в файл.
